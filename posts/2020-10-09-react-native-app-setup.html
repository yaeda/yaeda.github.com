<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><meta name="description" content="Takeshi Yaeda&#x27;s Blog"/><meta property="og:image" content="https://og-image.now.sh/yaeda.github.io.png?theme=light&amp;md=0&amp;fontSize=100px"/><meta name="og:title" content="yaeda.github.io"/><meta name="twitter:card" content="summary_large_image"/><title>React Native アプリ開発初期設定（2020/10 版）</title><meta name="next-head-count" content="8"/><link rel="preload" href="/_next/static/css/76c8651640da223a821c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/76c8651640da223a821c.css" data-n-g=""/><link rel="preload" href="/_next/static/css/07b97ef93b5cc0911948.css" as="style"/><link rel="stylesheet" href="/_next/static/css/07b97ef93b5cc0911948.css" data-n-p=""/><noscript data-n-css="true"></noscript><link rel="preload" href="/_next/static/chunks/main-ceab71ff4af1e6f937e6.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.9ec1f7868b3e9d138cdd.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.cb82874e43d6dd0d0fae.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-09253b7f91a5d3536181.js" as="script"/><link rel="preload" href="/_next/static/chunks/7989c093b81d86ddb0abfb342d5bc2e84730435d.ae55355a2d6373045c9b.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bid%5D-1798ce9ce107015bcf0d.js" as="script"/></head><body><div id="__next"><div class="layout_container__2t4v2"><header class="layout_header__2rhWq"><p class="utils_headingMd__3de6G"><a class="utils_colorInherit__3Gudf" href="/">yaeda.github.io</a></p></header><main class="layout_main__26dVU"><article><h1 class="utils_headingXl__1XecN">React Native アプリ開発初期設定（2020/10 版）</h1><div class="utils_lightText__12Ckm"><time dateTime="2020-10-09T00:00:00.000Z">October 9, 2020</time></div><div><p>Expo に Bare Workflow というのが出来てからなんとなく自分の中で React Native アプリ開発の初期設定の型が固まってきた感じがするので，一旦以下の項目について現状のやり方と次の機会に確認すべきポイントをまとめておく．</p>
<ul>
<li>プロジェクトの作成</li>
<li>App Name / Package Name / Bundle ID の変更</li>
<li>バージョン管理方法</li>
</ul>
<p>なおこの構成で 3 つほどアプリを作ってきてはいるが，どれも実際にストアに出すには至っていない．商用アプリ向けにはもっといい方法があるかもしれない（知りたい）．</p>
<h2>TL;DR</h2>
<p>Expo bare workflow + unimodules + Typescript なプロジェクトを作成</p>
<pre><code class="language-sh">npm install -g expo-cli # if you don't have expo command
expo init --template expo-template-bare-typescript
</code></pre>
<p>アプリ名と id を変更 （+マニュアル修正）</p>
<pre><code class="language-sh">npx react-native-rename "My App" -b io.github.yaeda.myapp
</code></pre>
<p><code>react-native-version</code>でバージョン管理</p>
<pre><code class="language-json">"scripts": {
  "postversion": "react-native-version
}
</code></pre>
<h2>プロジェクトの作成</h2>
<p>React Native でアプリを作るとなるとまず Expo が使えるかを検討する．Expo には managed workflow と bare workflow という二通りの使い方があり，managed workflow の方が使えれば話は早く，何も考えずに巻かれておけばよいと思う．ただし managed workflow には制約があり，一部の Native 機能が使えない．それぞれの workflow や制約については以下のリンクを参照．</p>
<ul>
<li><a href="https://docs.expo.io/introduction/managed-vs-bare/">Workflows - Expo Documentation</a></li>
<li><a href="https://docs.expo.io/introduction/why-not-expo/#build-service-only-works-in-the-managed">Limitations - Expo Documentation</a></li>
</ul>
<p>自分の場合は Bluetooth を使うことが多く，managed workflow が使えないので bare workflow を愛用している．bare workflow を使うと，普通の React Native アプリとして開発しながら unimodules という仕組みを利用して Expo 関連のライブラリを使えるようになる．完全に Expo から離れるという選択肢もあるとは思うが，経験上 Expo 関連のライブラリを使いたくなるケースが多く，後から対応するのはやや大変（後述）なので最初から bare workflow を使うと決めてかかったほうが幸せになれる．</p>
<p>ということで以下のコマンドで Expo bare workflow + unimodules + Typescript なプロジェクトを作成する．</p>
<pre><code class="language-sh">npm install -g expo-cli # if you don't have expo command
expo init --template expo-template-bare-typescript
</code></pre>
<h3>確認ポイント: 既存アプリのマイグレーションについて</h3>
<p>既に出来上がっている React Native アプリに unimodules 対応を入れる場合は以下のページを参照．</p>
<p><a href="https://docs.expo.io/bare/installing-unimodules/">Installing react-native-unimodules - Expo Documentation</a></p>
<p>現状はマニュアルで書き換える必要のあるファイル・変更数が多く，つらい．今後マイグレーションスクリプトなどができる可能性があるのでタイミングをみて確認すると良さそう．</p>
<h3>確認ポイント: <code>create-react-native-app</code>コマンドについて</h3>
<p>また，上記の unimodules 導入ページでおすすめされている<code>npx create-react-native-app</code>というコマンドは実行後の選択肢で「Default new app」を選ぶと unimodules 入りの bare workflow のプロジェクト（非 typescript）が生成されるが，「Template from expo/examples」を選ぶともれなく managed workflow になるので注意．今後 template の追加などで改善されるかもしれないのでここも確認ポイント．</p>
<h2>App Name / Package Name / Bundle ID の変更</h2>
<p><code>expo init</code>コマンドで指定できるアプリ名には（空白が使えない等の）制約があったり，Package Name（Android）や Bundle ID（iOS）が自動で付与されるので変更する必要がある．</p>
<p>ということで以下のコマンドでアプリ名と id を変更する．</p>
<pre><code class="language-sh">npx react-native-rename "My App" -b io.github.yaeda.myapp
</code></pre>
<p>が，対応不十分でかなりマニュアルでの修正が必要．みんなこれどうやってるのか教えて欲しい．</p>
<h3>確認ポイント: <code>expo init</code>のオプション</h3>
<p><code>expo init</code>のオプションは以下のページで解説がある．</p>
<p><a href="https://docs.expo.io/workflow/expo-cli/#expo-init">Expo CLI - Expo Documentation</a></p>
<p><code>--name</code>は「The name of your app visible on the home screen.」とあるが空白が入れられないなどの制約がある．昔はキャメルケースしかサポートしていなかったが，スネークケースやケバブケースも使えるようになったという経緯があるので今後さらなる改善があるかもしれない．</p>
<p>また，<code>--android-package</code>や<code>--ios-bundle-identifier</code>のようなオプションも検討された形跡がある．</p>
<ul>
<li><a href="https://github.com/expo/expo-cli/issues/824">expo init disregards --android-package and --ios-bundle-identifier arguments · Issue #824 · expo/expo-cli</a></li>
<li><a href="https://github.com/expo/expo-cli/pull/1878">feat(expo-cli): add package and bundle identifier to init by byCedric · Pull Request #1878 · expo/expo-cli</a></li>
</ul>
<p>このあたり公式でサポートされれば使いたいので要チェック．</p>
<h3>確認ポイント: ライブラリのアップデート </h3>
<p>公式の方法がない場合は 3rd party ライブラリが存在しないかチェックする．現時点で有力な<code>react-native-rename</code>や<code>react-native-ci-tools</code>は開発が止まっている．</p>
<h2>バージョン管理方法</h2>
<p>マルチプラットフォーム展開時のバージョン管理について，は今の所全てに共通のバージョンを付与する方針でやっている．pacakge.json の<code>postversion</code>に<code>react-native-version</code>を使うと楽．</p>
<pre><code class="language-json">"scripts": {
  "postversion": "react-native-version
}
</code></pre>
<p>こうすると<code>yarn version</code>すると連動して android と ios のバージョンも上げくれる．</p>
<p>ただし，app.json に expo フィールドが存在すると managed workflow だと勘違いされて正しくバージョン更新がされない問題がある．</p>
<ul>
<li><a href="https://github.com/stovmascript/react-native-version/issues/105">Issue with ejected Expo Project · Issue #105 · stovmascript/react-native-version</a></li>
</ul>
<p>そのため，app.json から expo フィールドを削除するか，以下の Pull Request 版を使うと良い．</p>
<ul>
<li><a href="https://github.com/stovmascript/react-native-version/pull/150">--ignore-expo cli option by killerchip · Pull Request #150 · stovmascript/react-native-version</a></li>
</ul>
<h3>確認ポイント: Issue #105</h3>
<p>上で説明した問題が解決されているかを確認する．早く対応してほしいので，同意できる人はコメントするなり action 付けるなりして欲しい．</p>
<h3>確認ポイント: OTA について</h3>
<p>実は OTA を使ったことがないので，OTA を真面目にやるとバージョン周りで考えることが増える気がしている．</p>
<h2>最後に</h2>
<p>一旦まとめた．他にも CI とかも固まりつつあるのでこのあたりも今後まとめたい．</p>
</div></article></main><div class="layout_backToHome__1vZsp"><a href="/">← Back to home</a></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"2020-10-09-react-native-app-setup","contentHtml":"\u003cp\u003eExpo に Bare Workflow というのが出来てからなんとなく自分の中で React Native アプリ開発の初期設定の型が固まってきた感じがするので，一旦以下の項目について現状のやり方と次の機会に確認すべきポイントをまとめておく．\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eプロジェクトの作成\u003c/li\u003e\n\u003cli\u003eApp Name / Package Name / Bundle ID の変更\u003c/li\u003e\n\u003cli\u003eバージョン管理方法\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eなおこの構成で 3 つほどアプリを作ってきてはいるが，どれも実際にストアに出すには至っていない．商用アプリ向けにはもっといい方法があるかもしれない（知りたい）．\u003c/p\u003e\n\u003ch2\u003eTL;DR\u003c/h2\u003e\n\u003cp\u003eExpo bare workflow + unimodules + Typescript なプロジェクトを作成\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sh\"\u003enpm install -g expo-cli # if you don't have expo command\nexpo init --template expo-template-bare-typescript\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eアプリ名と id を変更 （+マニュアル修正）\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sh\"\u003enpx react-native-rename \"My App\" -b io.github.yaeda.myapp\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003ereact-native-version\u003c/code\u003eでバージョン管理\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-json\"\u003e\"scripts\": {\n  \"postversion\": \"react-native-version\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eプロジェクトの作成\u003c/h2\u003e\n\u003cp\u003eReact Native でアプリを作るとなるとまず Expo が使えるかを検討する．Expo には managed workflow と bare workflow という二通りの使い方があり，managed workflow の方が使えれば話は早く，何も考えずに巻かれておけばよいと思う．ただし managed workflow には制約があり，一部の Native 機能が使えない．それぞれの workflow や制約については以下のリンクを参照．\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://docs.expo.io/introduction/managed-vs-bare/\"\u003eWorkflows - Expo Documentation\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://docs.expo.io/introduction/why-not-expo/#build-service-only-works-in-the-managed\"\u003eLimitations - Expo Documentation\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e自分の場合は Bluetooth を使うことが多く，managed workflow が使えないので bare workflow を愛用している．bare workflow を使うと，普通の React Native アプリとして開発しながら unimodules という仕組みを利用して Expo 関連のライブラリを使えるようになる．完全に Expo から離れるという選択肢もあるとは思うが，経験上 Expo 関連のライブラリを使いたくなるケースが多く，後から対応するのはやや大変（後述）なので最初から bare workflow を使うと決めてかかったほうが幸せになれる．\u003c/p\u003e\n\u003cp\u003eということで以下のコマンドで Expo bare workflow + unimodules + Typescript なプロジェクトを作成する．\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sh\"\u003enpm install -g expo-cli # if you don't have expo command\nexpo init --template expo-template-bare-typescript\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e確認ポイント: 既存アプリのマイグレーションについて\u003c/h3\u003e\n\u003cp\u003e既に出来上がっている React Native アプリに unimodules 対応を入れる場合は以下のページを参照．\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://docs.expo.io/bare/installing-unimodules/\"\u003eInstalling react-native-unimodules - Expo Documentation\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e現状はマニュアルで書き換える必要のあるファイル・変更数が多く，つらい．今後マイグレーションスクリプトなどができる可能性があるのでタイミングをみて確認すると良さそう．\u003c/p\u003e\n\u003ch3\u003e確認ポイント: \u003ccode\u003ecreate-react-native-app\u003c/code\u003eコマンドについて\u003c/h3\u003e\n\u003cp\u003eまた，上記の unimodules 導入ページでおすすめされている\u003ccode\u003enpx create-react-native-app\u003c/code\u003eというコマンドは実行後の選択肢で「Default new app」を選ぶと unimodules 入りの bare workflow のプロジェクト（非 typescript）が生成されるが，「Template from expo/examples」を選ぶともれなく managed workflow になるので注意．今後 template の追加などで改善されるかもしれないのでここも確認ポイント．\u003c/p\u003e\n\u003ch2\u003eApp Name / Package Name / Bundle ID の変更\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003eexpo init\u003c/code\u003eコマンドで指定できるアプリ名には（空白が使えない等の）制約があったり，Package Name（Android）や Bundle ID（iOS）が自動で付与されるので変更する必要がある．\u003c/p\u003e\n\u003cp\u003eということで以下のコマンドでアプリ名と id を変更する．\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-sh\"\u003enpx react-native-rename \"My App\" -b io.github.yaeda.myapp\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eが，対応不十分でかなりマニュアルでの修正が必要．みんなこれどうやってるのか教えて欲しい．\u003c/p\u003e\n\u003ch3\u003e確認ポイント: \u003ccode\u003eexpo init\u003c/code\u003eのオプション\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003eexpo init\u003c/code\u003eのオプションは以下のページで解説がある．\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://docs.expo.io/workflow/expo-cli/#expo-init\"\u003eExpo CLI - Expo Documentation\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e--name\u003c/code\u003eは「The name of your app visible on the home screen.」とあるが空白が入れられないなどの制約がある．昔はキャメルケースしかサポートしていなかったが，スネークケースやケバブケースも使えるようになったという経緯があるので今後さらなる改善があるかもしれない．\u003c/p\u003e\n\u003cp\u003eまた，\u003ccode\u003e--android-package\u003c/code\u003eや\u003ccode\u003e--ios-bundle-identifier\u003c/code\u003eのようなオプションも検討された形跡がある．\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/expo/expo-cli/issues/824\"\u003eexpo init disregards --android-package and --ios-bundle-identifier arguments · Issue #824 · expo/expo-cli\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/expo/expo-cli/pull/1878\"\u003efeat(expo-cli): add package and bundle identifier to init by byCedric · Pull Request #1878 · expo/expo-cli\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eこのあたり公式でサポートされれば使いたいので要チェック．\u003c/p\u003e\n\u003ch3\u003e確認ポイント: ライブラリのアップデート \b\u003c/h3\u003e\n\u003cp\u003e公式の方法がない場合は 3rd party ライブラリが存在しないかチェックする．現時点で有力な\u003ccode\u003ereact-native-rename\u003c/code\u003eや\u003ccode\u003ereact-native-ci-tools\u003c/code\u003eは開発が止まっている．\u003c/p\u003e\n\u003ch2\u003eバージョン管理方法\u003c/h2\u003e\n\u003cp\u003eマルチプラットフォーム展開時のバージョン管理について，は今の所全てに共通のバージョンを付与する方針でやっている．pacakge.json の\u003ccode\u003epostversion\u003c/code\u003eに\u003ccode\u003ereact-native-version\u003c/code\u003eを使うと楽．\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-json\"\u003e\"scripts\": {\n  \"postversion\": \"react-native-version\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eこうすると\u003ccode\u003eyarn version\u003c/code\u003eすると連動して android と ios のバージョンも上げくれる．\u003c/p\u003e\n\u003cp\u003eただし，app.json に expo フィールドが存在すると managed workflow だと勘違いされて正しくバージョン更新がされない問題がある．\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/stovmascript/react-native-version/issues/105\"\u003eIssue with ejected Expo Project · Issue #105 · stovmascript/react-native-version\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eそのため，app.json から expo フィールドを削除するか，以下の Pull Request 版を使うと良い．\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/stovmascript/react-native-version/pull/150\"\u003e--ignore-expo cli option by killerchip · Pull Request #150 · stovmascript/react-native-version\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003e確認ポイント: Issue #105\u003c/h3\u003e\n\u003cp\u003e上で説明した問題が解決されているかを確認する．早く対応してほしいので，同意できる人はコメントするなり action 付けるなりして欲しい．\u003c/p\u003e\n\u003ch3\u003e確認ポイント: OTA について\u003c/h3\u003e\n\u003cp\u003e実は OTA を使ったことがないので，OTA を真面目にやるとバージョン周りで考えることが増える気がしている．\u003c/p\u003e\n\u003ch2\u003e最後に\u003c/h2\u003e\n\u003cp\u003e一旦まとめた．他にも CI とかも固まりつつあるのでこのあたりも今後まとめたい．\u003c/p\u003e\n","title":"React Native アプリ開発初期設定（2020/10 版）","date":"2020-10-09T00:00:00.000Z"}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"2020-10-09-react-native-app-setup"},"buildId":"CXyiVWVBHu05-wBAvXegU","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-11c8eba6a84e3fddec04.js"></script><script src="/_next/static/chunks/main-ceab71ff4af1e6f937e6.js" async=""></script><script src="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" async=""></script><script src="/_next/static/chunks/framework.9ec1f7868b3e9d138cdd.js" async=""></script><script src="/_next/static/chunks/commons.cb82874e43d6dd0d0fae.js" async=""></script><script src="/_next/static/chunks/pages/_app-09253b7f91a5d3536181.js" async=""></script><script src="/_next/static/chunks/7989c093b81d86ddb0abfb342d5bc2e84730435d.ae55355a2d6373045c9b.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-1798ce9ce107015bcf0d.js" async=""></script><script src="/_next/static/CXyiVWVBHu05-wBAvXegU/_buildManifest.js" async=""></script><script src="/_next/static/CXyiVWVBHu05-wBAvXegU/_ssgManifest.js" async=""></script></body></html>