<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><meta name="description" content="Takeshi Yaeda&#x27;s Blog"/><meta property="og:image" content="https://og-image.now.sh/yaeda.github.io.png?theme=light&amp;md=0&amp;fontSize=100px"/><meta name="og:title" content="yaeda.github.io"/><meta name="twitter:card" content="summary_large_image"/><title>他のリポジトリのイベントで GitHub Actions をトリガーする</title><meta name="next-head-count" content="8"/><link rel="preload" href="/_next/static/css/76c8651640da223a821c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/76c8651640da223a821c.css" data-n-g=""/><link rel="preload" href="/_next/static/css/07b97ef93b5cc0911948.css" as="style"/><link rel="stylesheet" href="/_next/static/css/07b97ef93b5cc0911948.css" data-n-p=""/><noscript data-n-css="true"></noscript><link rel="preload" href="/_next/static/chunks/main-ceab71ff4af1e6f937e6.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.9ec1f7868b3e9d138cdd.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.cb82874e43d6dd0d0fae.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-09253b7f91a5d3536181.js" as="script"/><link rel="preload" href="/_next/static/chunks/7989c093b81d86ddb0abfb342d5bc2e84730435d.d6d4780f3f9b19312c4a.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bid%5D-0144ab10225657fc47b7.js" as="script"/></head><body><div id="__next"><div class="layout_container__2t4v2"><header class="layout_header__2rhWq"><p class="utils_headingMd__3de6G"><a class="utils_colorInherit__3Gudf" href="/">yaeda.github.io</a></p></header><main class="layout_main__26dVU"><article><h1 class="utils_headingXl__1XecN">他のリポジトリのイベントで GitHub Actions をトリガーする</h1><div class="utils_lightText__12Ckm"><time dateTime="2020-10-06 22:40">October 6, 2020</time></div><div><p>別のリポジトリのイベントをきっかけとして GitHub Actions の workflow をトリガーするというのをこのブログで設定したのでまとめておく．</p>
<p>このブログのソースコードは以下の２つに分かれている．</p>
<ul>
<li>Markdown の文章データを管理するリポジトリ（<a href="https://github.com/yaeda/blog-posts">yaeda/blog-posts</a>）</li>
<li>サイトのソースコードを管理するリポジトリ（<a href="https://github.com/yaeda/yaeda.github.com">yaeda/yaeda.github.com</a>）</li>
</ul>
<p>今回，yaeda/blog-posts の方に記事を上げたら，yaeda/yaeda.github.com の方で Build &#x26; Deploy を行うようにした．</p>
<h2>yaeda/blog-posts 側の設定</h2>
<p>以下の yml コードが 「main ブランチの posts ディレクトリの Markdown ファイルに変更があったら yaeda/yaeda.github.com に<code>deploy</code>というイベントを投げる」という設定．GitHub Actions の <a href="https://docs.github.com/en/free-pro-team@latest/actions/reference/events-that-trigger-workflows#repository_dispatch">repository_dispatch</a> という機能を使っているが， <a href="https://docs.github.com/en/free-pro-team@latest/actions/reference/events-that-trigger-workflows#workflow_dispatch">workflow_dispatch</a> でも同様のことができると思う．どちらも GitHub API 経由で workflow をトリガーする機能で，これを別のリポジトリの workflow の中で利用する．</p>
<pre><code class="language-yml">name: dispatch

on:
  push:
    branches:
      - main
    paths:
      - "posts/**.md"

jobs:
  dispatch:
    runs-on: ubuntu-latest
    steps:
      - name: Dispatch
        uses: peter-evans/repository-dispatch@v1
        with:
          token: ${{ secrets.REPO_ACCESS_TOKEN }}
          repository: yaeda/yaeda.github.com
          event-type: deploy
</code></pre>
<p>API を使う部分は <a href="https://github.com/peter-evans/repository-dispatch">peter-evans/repository-dispatch</a> という Action を作ってくれている人がいたので利用している．権限が足りずおなじみの <code>${{ secrets.GITHUB_TOKEN }}</code> が使えないので personal access token を用意する必要がある点に注意．詳しくはこちら（<a href="https://github.com/peter-evans/repository-dispatch#token">token on peter-evans/repository-dispatch</a>）．</p>
<h2>yaeda/yaeda.github.com の設定</h2>
<p>こちらでは <code>deploy</code> というイベントを受け取って Build &#x26; Deploy を行う．以下の例では「 main ブランチへの変更 もしくは <code>deploy</code> イベント」をトリガーとして publish ジョブが走るようになっている．ジョブの中で yaeda/yaeda.github.com と yaeda/blog-posts の２つのリポジトリを checkout してきて Build &#x26; Deploy を行っている．完全なコードはこちら（<a href="https://github.com/yaeda/yaeda.github.com/blob/main/.github/workflows/deploy.yml">yaeda.github.com/deploy.yml at main</a>）．</p>
<pre><code class="language-yml">name: deploy

on:
  push:
    branches:
      - main
  repository_dispatch:
    types:
      - deploy

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Checkout Blog Posts
        uses: actions/checkout@v2
        with:
          repository: yaeda/blog-posts
          path: blog-posts

      .
      .
      .
</code></pre>
<h2>所感</h2>
<p>ここで紹介した方法は連携する両方のリポジトリに設定が必要なので，自分のリポジトリや所属している組織のリポジトリのような閉じた状況でないと使いづらい．たとえば「React Native の新しいバージョンがリリースされたら更新する PR つくってテストしよう」みたいなのは難しい．そういうときは Renovate とか使いましょう．</p>
<p>最近はもう GitHub Actions しか使ってなくて，機能も十分だと感じている．あまり凝ったことをしてないってものあるけど，便利．他の人の技も盗みたいと思って zenn.dev を検索してみたら同じ内容の記事を見つけた．こちらも参考にできそう．</p>
<ul>
<li><a href="https://zenn.dev/search?q=github%2520actions">検索 | Zenn</a></li>
<li><a href="https://zenn.dev/mizchi/articles/3117b92a834531361fc8">Github Actions で他のリポジトリからの変更通知を受け取って PR を作成する Workflow | Zenn</a></li>
</ul>
</div></article></main><div class="layout_backToHome__1vZsp"><a href="/">← Back to home</a></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"2020-10-06-github-actions-repository-dispatch","contentHtml":"\u003cp\u003e別のリポジトリのイベントをきっかけとして GitHub Actions の workflow をトリガーするというのをこのブログで設定したのでまとめておく．\u003c/p\u003e\n\u003cp\u003eこのブログのソースコードは以下の２つに分かれている．\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eMarkdown の文章データを管理するリポジトリ（\u003ca href=\"https://github.com/yaeda/blog-posts\"\u003eyaeda/blog-posts\u003c/a\u003e）\u003c/li\u003e\n\u003cli\u003eサイトのソースコードを管理するリポジトリ（\u003ca href=\"https://github.com/yaeda/yaeda.github.com\"\u003eyaeda/yaeda.github.com\u003c/a\u003e）\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e今回，yaeda/blog-posts の方に記事を上げたら，yaeda/yaeda.github.com の方で Build \u0026#x26; Deploy を行うようにした．\u003c/p\u003e\n\u003ch2\u003eyaeda/blog-posts 側の設定\u003c/h2\u003e\n\u003cp\u003e以下の yml コードが 「main ブランチの posts ディレクトリの Markdown ファイルに変更があったら yaeda/yaeda.github.com に\u003ccode\u003edeploy\u003c/code\u003eというイベントを投げる」という設定．GitHub Actions の \u003ca href=\"https://docs.github.com/en/free-pro-team@latest/actions/reference/events-that-trigger-workflows#repository_dispatch\"\u003erepository_dispatch\u003c/a\u003e という機能を使っているが， \u003ca href=\"https://docs.github.com/en/free-pro-team@latest/actions/reference/events-that-trigger-workflows#workflow_dispatch\"\u003eworkflow_dispatch\u003c/a\u003e でも同様のことができると思う．どちらも GitHub API 経由で workflow をトリガーする機能で，これを別のリポジトリの workflow の中で利用する．\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-yml\"\u003ename: dispatch\n\non:\n  push:\n    branches:\n      - main\n    paths:\n      - \"posts/**.md\"\n\njobs:\n  dispatch:\n    runs-on: ubuntu-latest\n    steps:\n      - name: Dispatch\n        uses: peter-evans/repository-dispatch@v1\n        with:\n          token: ${{ secrets.REPO_ACCESS_TOKEN }}\n          repository: yaeda/yaeda.github.com\n          event-type: deploy\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAPI を使う部分は \u003ca href=\"https://github.com/peter-evans/repository-dispatch\"\u003epeter-evans/repository-dispatch\u003c/a\u003e という Action を作ってくれている人がいたので利用している．権限が足りずおなじみの \u003ccode\u003e${{ secrets.GITHUB_TOKEN }}\u003c/code\u003e が使えないので personal access token を用意する必要がある点に注意．詳しくはこちら（\u003ca href=\"https://github.com/peter-evans/repository-dispatch#token\"\u003etoken on peter-evans/repository-dispatch\u003c/a\u003e）．\u003c/p\u003e\n\u003ch2\u003eyaeda/yaeda.github.com の設定\u003c/h2\u003e\n\u003cp\u003eこちらでは \u003ccode\u003edeploy\u003c/code\u003e というイベントを受け取って Build \u0026#x26; Deploy を行う．以下の例では「 main ブランチへの変更 もしくは \u003ccode\u003edeploy\u003c/code\u003e イベント」をトリガーとして publish ジョブが走るようになっている．ジョブの中で yaeda/yaeda.github.com と yaeda/blog-posts の２つのリポジトリを checkout してきて Build \u0026#x26; Deploy を行っている．完全なコードはこちら（\u003ca href=\"https://github.com/yaeda/yaeda.github.com/blob/main/.github/workflows/deploy.yml\"\u003eyaeda.github.com/deploy.yml at main\u003c/a\u003e）．\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-yml\"\u003ename: deploy\n\non:\n  push:\n    branches:\n      - main\n  repository_dispatch:\n    types:\n      - deploy\n\njobs:\n  publish:\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v2\n\n      - name: Checkout Blog Posts\n        uses: actions/checkout@v2\n        with:\n          repository: yaeda/blog-posts\n          path: blog-posts\n\n      .\n      .\n      .\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e所感\u003c/h2\u003e\n\u003cp\u003eここで紹介した方法は連携する両方のリポジトリに設定が必要なので，自分のリポジトリや所属している組織のリポジトリのような閉じた状況でないと使いづらい．たとえば「React Native の新しいバージョンがリリースされたら更新する PR つくってテストしよう」みたいなのは難しい．そういうときは Renovate とか使いましょう．\u003c/p\u003e\n\u003cp\u003e最近はもう GitHub Actions しか使ってなくて，機能も十分だと感じている．あまり凝ったことをしてないってものあるけど，便利．他の人の技も盗みたいと思って zenn.dev を検索してみたら同じ内容の記事を見つけた．こちらも参考にできそう．\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://zenn.dev/search?q=github%2520actions\"\u003e検索 | Zenn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://zenn.dev/mizchi/articles/3117b92a834531361fc8\"\u003eGithub Actions で他のリポジトリからの変更通知を受け取って PR を作成する Workflow | Zenn\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","title":"他のリポジトリのイベントで GitHub Actions をトリガーする","date":"2020-10-06 22:40"}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"2020-10-06-github-actions-repository-dispatch"},"buildId":"qtkvDhFd4Ja-e0Xl2FxKm","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-11c8eba6a84e3fddec04.js"></script><script src="/_next/static/chunks/main-ceab71ff4af1e6f937e6.js" async=""></script><script src="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" async=""></script><script src="/_next/static/chunks/framework.9ec1f7868b3e9d138cdd.js" async=""></script><script src="/_next/static/chunks/commons.cb82874e43d6dd0d0fae.js" async=""></script><script src="/_next/static/chunks/pages/_app-09253b7f91a5d3536181.js" async=""></script><script src="/_next/static/chunks/7989c093b81d86ddb0abfb342d5bc2e84730435d.d6d4780f3f9b19312c4a.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-0144ab10225657fc47b7.js" async=""></script><script src="/_next/static/qtkvDhFd4Ja-e0Xl2FxKm/_buildManifest.js" async=""></script><script src="/_next/static/qtkvDhFd4Ja-e0Xl2FxKm/_ssgManifest.js" async=""></script></body></html>