<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><meta name="description" content="Takeshi Yaeda&#x27;s Blog"/><meta property="og:image" content="https://og-image.now.sh/yaeda.github.io.png?theme=light&amp;md=0&amp;fontSize=100px"/><meta name="og:title" content="yaeda.github.io"/><meta name="twitter:card" content="summary_large_image"/><title>他のリポジトリのイベントで GitHub Actions をトリガーする</title><meta name="next-head-count" content="8"/><link rel="preload" href="/_next/static/css/f533d2460c7e975c15c9.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f533d2460c7e975c15c9.css" data-n-g=""/><link rel="preload" href="/_next/static/css/5261d44d0d9e40acce07.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5261d44d0d9e40acce07.css" data-n-p=""/><noscript data-n-css="true"></noscript><link rel="preload" href="/_next/static/chunks/main-ceab71ff4af1e6f937e6.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.1d36bc031662b4dc4c28.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.cb82874e43d6dd0d0fae.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-99cbb240ffe284896e8a.js" as="script"/><link rel="preload" href="/_next/static/chunks/7989c093b81d86ddb0abfb342d5bc2e84730435d.ae55355a2d6373045c9b.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bid%5D-507aa56731fa7f19cc6f.js" as="script"/></head><body><div id="__next"><div class="layout_container__2t4v2"><header class="layout_header__2rhWq"><p class="utils_headingMd__3de6G"><a class="utils_colorInherit__3Gudf" href="/">yaeda.github.io</a></p></header><main class="layout_main__26dVU"><article><h1 class="utils_headingXl__1XecN">他のリポジトリのイベントで GitHub Actions をトリガーする</h1><div class="utils_lightText__12Ckm"><time dateTime="2020-10-06 22:40">October 6, 2020</time></div><div class="mdpreview"><p>別のリポジトリのイベントをきっかけとして GitHub Actions の workflow をトリガーするというのをこのブログで設定したのでまとめておく．</p><p>このブログのソースコードは以下の２つに分かれている．</p><ul><li>Markdown の文章データを管理するリポジトリ（<a href="https://github.com/yaeda/blog-posts">yaeda/blog-posts</a>）</li><li>サイトのソースコードを管理するリポジトリ（<a href="https://github.com/yaeda/yaeda.github.com">yaeda/yaeda<!-- -->.<!-- -->github<!-- -->.<!-- -->com</a>）</li></ul><p>今回，yaeda/blog-posts の方に記事を上げたら，yaeda/yaeda.github.com の方で Build &amp; Deploy を行うようにした．</p><h2>yaeda/blog-posts 側の設定</h2><p>以下の yml コードが 「main ブランチの posts ディレクトリの Markdown ファイルに変更があったら yaeda/yaeda.github.com に<code>deploy</code>というイベントを投げる」という設定．GitHub Actions の <a href="https://docs.github.com/en/free-pro-team@latest/actions/reference/events-that-trigger-workflows#repository_dispatch">repository_dispatch</a> という機能を使っているが， <a href="https://docs.github.com/en/free-pro-team@latest/actions/reference/events-that-trigger-workflows#workflow_dispatch">workflow_dispatch</a> でも同様のことができると思う．どちらも GitHub API 経由で workflow をトリガーする機能で，これを別のリポジトリの workflow の中で利用する．</p><figure class="code-block_figure__3kq81"><figcaption class="code-block_figcaption__16kwp">blog-posts/.github/workflows/dispatch.yml</figcaption><pre style="display:block;overflow-x:auto;background:#2b2b2b;color:#f8f8f2;padding:0.5em"><code class="language-yml" style="white-space:pre"><span style="color:#ffd700">name</span><span>: dispatch
</span>
<span></span><span style="color:#ffd700">on</span><span>:
</span><span>  </span><span style="color:#ffd700">push</span><span>:
</span><span>    </span><span style="color:#ffd700">branches</span><span>:
</span>      - main
<span>    </span><span style="color:#ffd700">paths</span><span>:
</span><span>      - </span><span style="color:#abe338">&quot;posts/**.md&quot;</span><span>
</span>
<span></span><span style="color:#ffd700">jobs</span><span>:
</span><span>  </span><span style="color:#ffd700">dispatch</span><span>:
</span><span>    </span><span style="color:#ffd700">runs-on</span><span>: ubuntu-latest
</span><span>    </span><span style="color:#ffd700">steps</span><span>:
</span><span>      - </span><span style="color:#ffd700">name</span><span>: Dispatch
</span><span>        </span><span style="color:#ffd700">uses</span><span>: peter-evans/repository-dispatch</span><span style="color:#ffa07a">@v1</span><span>
</span><span>        </span><span style="color:#ffd700">with</span><span>:
</span><span>          </span><span style="color:#ffd700">token</span><span>: ${{ secrets.REPO_ACCESS_TOKEN }}
</span><span>          </span><span style="color:#ffd700">repository</span><span>: yaeda/yaeda.github.com
</span><span>          </span><span style="color:#ffd700">event-type</span><span>: deploy</span></code></pre></figure><p>API を使う部分は <a href="https://github.com/peter-evans/repository-dispatch">peter<!-- -->-<!-- -->evans/repository<!-- -->-<!-- -->dispatch</a> という Action を作ってくれている人がいたので利用している．権限が足りずおなじみの <code>${{ secrets.GITHUB_TOKEN }}</code> が使えないので personal access token を用意する必要がある点に注意．詳しくはこちら（<a href="https://github.com/peter-evans/repository-dispatch#token">token on peter<!-- -->-<!-- -->evans/repository<!-- -->-<!-- -->dispatch</a>）．</p><h2>yaeda/yaeda.github.com の設定</h2><p>こちらでは <code>deploy</code> というイベントを受け取って Build &amp; Deploy を行う．以下の例では「 main ブランチへの変更 もしくは <code>deploy</code> イベント」をトリガーとして publish ジョブが走るようになっている．ジョブの中で yaeda/yaeda.github.com と yaeda/blog-posts の２つのリポジトリを checkout してきて Build &amp; Deploy を行っている．完全なコードはこちら（<a href="https://github.com/yaeda/yaeda.github.com/blob/main/.github/workflows/deploy.yml">yaeda<!-- -->.<!-- -->github<!-- -->.<!-- -->com/deploy<!-- -->.<!-- -->yml at main</a>）．</p><figure class="code-block_figure__3kq81"><figcaption class="code-block_figcaption__16kwp">yaeda.github.com/.github/workflows/deploy.yml</figcaption><pre style="display:block;overflow-x:auto;background:#2b2b2b;color:#f8f8f2;padding:0.5em"><code class="language-yml" style="white-space:pre"><span style="color:#ffd700">name</span><span>: deploy
</span>
<span></span><span class="less" style="color:#ffd700">on</span><span class="less">:
</span><span class="less">  </span><span class="less" style="color:#ffd700">push</span><span class="less">:
</span><span class="less">    </span><span class="less" style="color:#ffd700">branches</span><span class="less">:
</span><span class="less">      - main
</span><span class="less">  </span><span class="less" style="color:#ffd700">repository_dispatch</span><span class="less">:
</span><span class="less">    </span><span class="less" style="color:#ffd700">types</span><span class="less">:
</span><span class="less">      - deploy
</span><span class="less">
</span><span class="less"></span><span class="less" style="color:#ffd700">jobs</span><span class="less">:
</span><span class="less">  </span><span class="less" style="color:#ffd700">publish</span><span class="less">:
</span><span class="less">    </span><span class="less" style="color:#ffd700">runs-on</span><span class="less">: ubuntu-latest
</span><span class="less">    </span><span class="less" style="color:#ffd700">steps</span><span class="less">:
</span><span class="less">      - </span><span class="less" style="color:#ffd700">name</span><span class="less">: Checkout
</span><span class="less">        </span><span class="less" style="color:#ffd700">uses</span><span class="less">: actions/checkout</span><span class="less" style="color:#ffa07a">@v2</span><span class="less">
</span><span class="less">
</span><span class="less">      - </span><span class="less" style="color:#ffd700">name</span><span class="less">: Checkout Blog Posts
</span><span class="less">        </span><span class="less" style="color:#ffd700">uses</span><span class="less">: actions/checkout</span><span class="less" style="color:#ffa07a">@v2</span><span class="less">
</span><span class="less">        </span><span class="less" style="color:#ffd700">with</span><span class="less">:
</span><span class="less">          </span><span class="less" style="color:#ffd700">repository</span><span class="less">: yaeda/blog-posts
</span><span class="less">          </span><span class="less" style="color:#ffd700">path</span><span class="less">: blog-posts
</span><span class="less">
</span><span class="less">      .
</span><span class="less">      .
</span><span class="less">      .
</span></code></pre></figure><h2>所感</h2><p>ここで紹介した方法は連携する両方のリポジトリに設定が必要なので，自分のリポジトリや所属している組織のリポジトリのような閉じた状況でないと使いづらい．たとえば「React Native の新しいバージョンがリリースされたら更新する PR つくってテストしよう」みたいなのは難しい．そういうときは Renovate とか使いましょう．</p><p>最近はもう GitHub Actions しか使ってなくて，機能も十分だと感じている．あまり凝ったことをしてないってものあるけど，便利．他の人の技も盗みたいと思って zenn.dev を検索してみたら同じ内容の記事を見つけた．こちらも参考にできそう．</p><ul><li><a href="https://zenn.dev/search?q=github%2520actions">検索 <!-- -->|<!-- --> Zenn</a></li><li><a href="https://zenn.dev/mizchi/articles/3117b92a834531361fc8">Github Actions で他のリポジトリからの変更通知を受け取って PR を作成する Workflow <!-- -->|<!-- --> Zenn</a></li></ul></div></article></main><div class="layout_backToHome__1vZsp"><a href="/">← Back to home</a></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"2020-10-06-github-actions-repository-dispatch","content":"\n別のリポジトリのイベントをきっかけとして GitHub Actions の workflow をトリガーするというのをこのブログで設定したのでまとめておく．\n\nこのブログのソースコードは以下の２つに分かれている．\n\n- Markdown の文章データを管理するリポジトリ（[yaeda/blog-posts](https://github.com/yaeda/blog-posts)）\n- サイトのソースコードを管理するリポジトリ（[yaeda/yaeda\\.github\\.com](https://github.com/yaeda/yaeda.github.com)）\n\n今回，yaeda/blog-posts の方に記事を上げたら，yaeda/yaeda.github.com の方で Build \u0026 Deploy を行うようにした．\n\n## yaeda/blog-posts 側の設定\n\n以下の yml コードが 「main ブランチの posts ディレクトリの Markdown ファイルに変更があったら yaeda/yaeda.github.com に`deploy`というイベントを投げる」という設定．GitHub Actions の [repository_dispatch](https://docs.github.com/en/free-pro-team@latest/actions/reference/events-that-trigger-workflows#repository_dispatch) という機能を使っているが， [workflow_dispatch](https://docs.github.com/en/free-pro-team@latest/actions/reference/events-that-trigger-workflows#workflow_dispatch) でも同様のことができると思う．どちらも GitHub API 経由で workflow をトリガーする機能で，これを別のリポジトリの workflow の中で利用する．\n\n```yml:blog-posts/.github/workflows/dispatch.yml\nname: dispatch\n\non:\n  push:\n    branches:\n      - main\n    paths:\n      - \"posts/**.md\"\n\njobs:\n  dispatch:\n    runs-on: ubuntu-latest\n    steps:\n      - name: Dispatch\n        uses: peter-evans/repository-dispatch@v1\n        with:\n          token: ${{ secrets.REPO_ACCESS_TOKEN }}\n          repository: yaeda/yaeda.github.com\n          event-type: deploy\n```\n\nAPI を使う部分は [peter\\-evans/repository\\-dispatch](https://github.com/peter-evans/repository-dispatch) という Action を作ってくれている人がいたので利用している．権限が足りずおなじみの `${{ secrets.GITHUB_TOKEN }}` が使えないので personal access token を用意する必要がある点に注意．詳しくはこちら（[token on peter\\-evans/repository\\-dispatch](https://github.com/peter-evans/repository-dispatch#token)）．\n\n## yaeda/yaeda.github.com の設定\n\nこちらでは `deploy` というイベントを受け取って Build \u0026 Deploy を行う．以下の例では「 main ブランチへの変更 もしくは `deploy` イベント」をトリガーとして publish ジョブが走るようになっている．ジョブの中で yaeda/yaeda.github.com と yaeda/blog-posts の２つのリポジトリを checkout してきて Build \u0026 Deploy を行っている．完全なコードはこちら（[yaeda\\.github\\.com/deploy\\.yml at main](https://github.com/yaeda/yaeda.github.com/blob/main/.github/workflows/deploy.yml)）．\n\n```yml:yaeda.github.com/.github/workflows/deploy.yml\nname: deploy\n\non:\n  push:\n    branches:\n      - main\n  repository_dispatch:\n    types:\n      - deploy\n\njobs:\n  publish:\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v2\n\n      - name: Checkout Blog Posts\n        uses: actions/checkout@v2\n        with:\n          repository: yaeda/blog-posts\n          path: blog-posts\n\n      .\n      .\n      .\n```\n\n## 所感\n\nここで紹介した方法は連携する両方のリポジトリに設定が必要なので，自分のリポジトリや所属している組織のリポジトリのような閉じた状況でないと使いづらい．たとえば「React Native の新しいバージョンがリリースされたら更新する PR つくってテストしよう」みたいなのは難しい．そういうときは Renovate とか使いましょう．\n\n最近はもう GitHub Actions しか使ってなくて，機能も十分だと感じている．あまり凝ったことをしてないってものあるけど，便利．他の人の技も盗みたいと思って zenn.dev を検索してみたら同じ内容の記事を見つけた．こちらも参考にできそう．\n\n- [検索 \\| Zenn](https://zenn.dev/search?q=github%2520actions)\n- [Github Actions で他のリポジトリからの変更通知を受け取って PR を作成する Workflow \\| Zenn](https://zenn.dev/mizchi/articles/3117b92a834531361fc8)\n","title":"他のリポジトリのイベントで GitHub Actions をトリガーする","date":"2020-10-06 22:40"}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"2020-10-06-github-actions-repository-dispatch"},"buildId":"x0udAItBxPvcL5kX_FYN4","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-11c8eba6a84e3fddec04.js"></script><script src="/_next/static/chunks/main-ceab71ff4af1e6f937e6.js" async=""></script><script src="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" async=""></script><script src="/_next/static/chunks/framework.1d36bc031662b4dc4c28.js" async=""></script><script src="/_next/static/chunks/commons.cb82874e43d6dd0d0fae.js" async=""></script><script src="/_next/static/chunks/pages/_app-99cbb240ffe284896e8a.js" async=""></script><script src="/_next/static/chunks/7989c093b81d86ddb0abfb342d5bc2e84730435d.ae55355a2d6373045c9b.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-507aa56731fa7f19cc6f.js" async=""></script><script src="/_next/static/x0udAItBxPvcL5kX_FYN4/_buildManifest.js" async=""></script><script src="/_next/static/x0udAItBxPvcL5kX_FYN4/_ssgManifest.js" async=""></script></body></html>